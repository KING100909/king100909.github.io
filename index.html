<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√≤ng Chat C√° Nh√¢n</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; justify-content: center; height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { width: 100%; max-width: 500px; background: white; display: flex; flex-direction: column; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        h2 { background: var(--primary); color: white; margin: 0; padding: 20px; text-align: center; font-size: 1.2rem; }
        
        /* Khu v·ª±c hi·ªÉn th·ªã tin nh·∫Øn */
        #chatDisplay { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; background: #ffffff; }
        .message-box { background: #f8fafc; padding: 10px 15px; border-radius: 12px; border: 1px solid #e2e8f0; position: relative; animation: fadeIn 0.2s ease; }
        .user-name { display: block; font-size: 0.75rem; font-weight: bold; color: var(--primary); margin-bottom: 4px; text-transform: uppercase; }
        .message-text { color: #334155; line-height: 1.4; word-wrap: break-word; }
        .btn-delete { position: absolute; top: 5px; right: 10px; color: #cbd5e1; cursor: pointer; border: none; background: none; font-size: 16px; }
        .btn-delete:hover { color: #ef4444; }

        /* Khu v·ª±c nh·∫≠p li·ªáu */
        .input-area { padding: 20px; border-top: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; gap: 10px; }
        input { padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; outline: none; }
        input:focus { border-color: var(--primary); }
        #userName { width: 80px; font-weight: bold; }
        #noteInput { flex: 1; }
        .btn-send { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>Nh·∫≠t K√Ω Tr√≤ Chuy·ªán üìù</h2>
    <div id="chatDisplay"></div>
    <div class="input-area">
        <div class="row">
            <input type="text" id="userName" placeholder="T√™n...">
            <input type="text" id="noteInput" placeholder="Nh·∫≠p tin nh·∫Øn...">
        </div>
        <button class="btn-send" onclick="App.sendMessage()">G·ª¨I TIN NH·∫ÆN</button>
    </div>
</div>

<script>
    const App = (() => {
        // TR·∫†NG TH√ÅI: T·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu t·ª´ LocalStorage khi m·ªü trang
        const state = new Proxy({
            messages: JSON.parse(localStorage.getItem('my_private_chat')) || []
        }, {
            set(target, property, value) {
                target[property] = value;
                localStorage.setItem('my_private_chat', JSON.stringify(value));
                render();
                return true;
            }
        });

        function render() {
            const display = document.getElementById('chatDisplay');
            display.innerHTML = state.messages.map((msg, index) => `
                <div class="message-box">
                    <button class="btn-delete" onclick="App.deleteMessage(${index})">√ó</button>
                    <span class="user-name">${sanitize(msg.user)}</span>
                    <div class="message-text">${sanitize(msg.text)}</div>
                </div>
            `).join('');
            display.scrollTop = display.scrollHeight;
        }

        function sanitize(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        // T·ª± load t√™n c≈© v√† tin nh·∫Øn c≈© khi v·ª´a m·ªü web
        window.onload = () => {
            const savedName = localStorage.getItem('chat_user_name');
            if (savedName) document.getElementById('userName').value = savedName;
            render();
        };

        return {
            sendMessage() {
                const nameInp = document.getElementById('userName');
                const textInp = document.getElementById('noteInput');
                const user = nameInp.value.trim() || "·∫®n danh";
                const text = textInp.value.trim();

                if (!text) return;

                // L∆∞u t√™n v√†o m√°y ƒë·ªÉ l·∫ßn sau kh√¥ng ph·∫£i nh·∫≠p l·∫°i
                localStorage.setItem('chat_user_name', user);

                // C·∫≠p nh·∫≠t m·∫£ng tin nh·∫Øn (Proxy s·∫Ω t·ª± l∆∞u v√†o LocalStorage v√† Render)
                state.messages = [...state.messages, { user, text }];

                textInp.value = '';
                textInp.focus();
            },
            deleteMessage(index) {
                if (confirm("X√≥a tin nh·∫Øn n√†y?")) {
                    const newMsgs = [...state.messages];
                    newMsgs.splice(index, 1);
                    state.messages = newMsgs;
                }
            }
        };
    })();

    // Nh·∫•n Enter ƒë·ªÉ g·ª≠i
    document.getElementById('noteInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') App.sendMessage();
    });
</script>

</body>
</html>
